buildscript {
    repositories {
        google()
        mavenCentral()
        jcenter()
    }
    dependencies {
        classpath "com.android.tools.build:gradle:${cordovaConfig.AGP_VERSION}"
        classpath "com.google.gms:google-services:4.4.4"
        // Crashlytics removed intentionally
        // classpath "com.google.firebase:firebase-crashlytics-gradle:2.8.1"
    }
}

repositories {
    mavenCentral()
    maven {
        url "https://maven.google.com"
    }
}

// Remove Crashlytics plugin entirely
// apply plugin: com.google.firebase.crashlytics.buildtools.gradle.CrashlyticsPlugin

// Keep only Android block if needed for other configs
android {
    buildTypes {
        debug {
            // Disable Crashlytics mapping upload if plugin present
            if (project.hasProperty("firebaseCrashlytics")) {
                firebaseCrashlytics {
                    mappingFileUploadEnabled false
                }
            }
        }
        release {
            // Disable Crashlytics symbol uploads if plugin present
            if (project.hasProperty("firebaseCrashlytics")) {
                firebaseCrashlytics {
                    nativeSymbolUploadEnabled false
                }
            }
        }
    }
}

// Safely apply Google Services plugin *after* the Android app plugin is available
cdvPluginPostBuildExtras.add({
    afterEvaluate {
        rootProject.subprojects {
            if (name == "app") {
                if (!plugins.hasPlugin('com.google.gms.google-services')) {
                    apply plugin: 'com.google.gms.google-services'
                }
            }
        }
    }
})